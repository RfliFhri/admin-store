<h2>Purchases</h2>

<div class="d-flex justify-content-end">
  <!-- Button trigger modal -->
  <button
    type="button"
    class="btn btn-primary"
    data-bs-toggle="modal"
    data-bs-target="#staticBackdrop"
  >
    Tambah Pembelian
  </button>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Produk</th>
      <th scope="col">Qty</th>
      <th scope="col">Total</th>
      <th scope="col">Status</th>
      <th scope="col">Aksi</th>
    </tr>
  </thead>
  <tbody>
    <% if (purchases.length === 0) { %>
    <tr>
      <td colspan="6" class="text-center fs-5 text-muted te">
        Belum ada pembelian
      </td>
    </tr>
    <% } else { let i = 0; %> <% purchases.forEach(p => { i++ %>
    <tr>
      <th scope="row"><%= i %></th>
      <td><%= p.name %></td>
      <td><%= p.quantity %></td>
      <td>Rp <%= p.total_price %></td>
      <td class="text-success"><%= p.status %></td>
      <td>
        <% if(p.status === 'ACTIVE'){ %>

        <button
          class="btn btn-warning btn-sm"
          onclick="cancelPurchase(`<%= p.id %>`)"
        >
          Cancel
        </button>

        <% } %> <% if (p.status === 'CANCELLED') { %>
        <button
          class="btn btn-danger btn-sm"
          onclick="deletePurchase(`<%= p.id %>`)"
        >
          Delete
        </button>
        <% } %>
      </td>
    </tr>
    <% }) } %>
  </tbody>
</table>

<!-- Modal add start -->
<div
  class="modal fade"
  id="staticBackdrop"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">
          Tambah Pembelian
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <!-- Form Start -->
        <form method="POST" id="purchaseForm" action="/purchases/add">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="product" class="form-label">Produk</label>
                  <select
                    id="product"
                    name="product_id"
                    class="form-select"
                    aria-label="Product Name"
                  >
                    <% products.forEach(p => { %>
                    <option value="<%= p.id %>"><%= p.name %></option>
                    <% }) %>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="quantity" class="form-label">Jumlah</label>
                  <input
                    type="number"
                    class="form-control"
                    id="quantity"
                    name="quantity"
                    required
                  />
                </div>
              </div>
            </div>
            <div class="row">
              <div
                class="gap-2 pt-3 mt-2 d-flex justify-content-end border-top"
              >
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-primary">Submit</button>
              </div>
            </div>
          </div>
        </form>
        <!-- Form End -->
      </div>
    </div>
  </div>
</div>
<!-- Modal add end -->
